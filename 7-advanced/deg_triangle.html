<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>退化三角形</title>
<style>
body {
    font-family: Monospace;
    color: #555;
    margin: 0;
    overflow: hidden;
}
</style>
</head>
<body>
<h3>使用退化三角形同时一次性绘制分离的图形</h3>
<canvas id="canvas" width="800" height="600"></canvas>
<script type="x-shader/x-vertex" id="vs">
    attribute vec4 a_position; 

    void main() { 
        gl_Position  = a_position;
    }
</script>
<script type="x-shader/x-fragment" id="fs">
    #ifdef GL_ES
        precision mediump float;
    #endif
    uniform vec4 u_color;

    void main() {
        gl_FragColor = u_color;
    }
</script>
<script src="./js/webgl-util.js"></script>
<script src="./js/matrix.js"></script>
<script>
    var canvas = document.getElementById("canvas"),
        gl = get3DContext(canvas, true),
        viewPosition = [0, 0, 6],
        lightPosition = [0, 0, 6];

    var program = createProgramInfo(gl, 'vs','fs');
    var hexagon = {
        position: [
            -0.3, 0.6, 0,
            -0.4, 0.8, 0,
            -0.6, 0.8, 0,
            -0.7, 0.6, 0,
            -0.6, 0.4, 0,
            -0.4, 0.4, 0,
            -0.3, 0.6, 0
        ]
    };
    var triangle = {
        position:[
            0.3,0.4,0,
            0.7,0.4,0,
            0.5,0.8,0
        ]
    };

    var stripVertices = {
        position:[
            -0.5,0.2,0,
            -0.4,0,0,
            -0.3,0.2,0,
            -0.2,0,0,
            -0.1,0.2,0,
            0,0,0,
            0.1,0.2,0,
            0.2,0,0,
            0.3,0.2,0,
            0.4,0,0,
            0.5,0.2,0,
            //填充退化三角形，第一个三角形带为奇数，所以填充三个顶点
            0.5,0.2,0,
            0.5,0.2,0,
            -0.5,-0.3,0,
            //第二个三角形带
            -0.5,-0.3,0,
            -0.4,-0.5,0,
            -0.3,-0.3,0,
            -0.2,-0.5,0,
            -0.1,-0.3,0,
            0,-0.5,0,
            0.1,-0.3,0,
            0.2,-0.5,0,
            0.3,-0.3,0,
            0.4,-0.5,0,
            0.5,-0.3,0,
        ]
    }
    var hexagonBuffer = createBufferInfoFromArrays(gl, hexagon);
    var triangleBuffer = createBufferInfoFromArrays(gl,triangle);
    var stripBuffer = createBufferInfoFromArrays(gl,stripVertices);

    gl.clearColor(0.0, 0.0, 0.0, 1.0);
    // 开启隐藏面消除
    gl.enable(gl.DEPTH_TEST);
    // 设置绘图区域
    gl.viewport(0, 0, canvas.width, canvas.height);

    gl.useProgram(program.program);
    drawHexagon();
    drawTriangle();
    drawStripTriangle();
    
    function drawHexagon(){
        setUniforms(program, {u_color:[0.8,0,0,1]});
        setBuffersAndAttributes(gl, program, hexagonBuffer);
        gl.drawArrays(gl.LINE_STRIP,0,hexagonBuffer.count);
    }

    function drawTriangle() {
        setUniforms(program, {u_color:[0,0.8,0,1]});
        setBuffersAndAttributes(gl, program, triangleBuffer);
        gl.drawArrays(gl.TRIANGLES,0,triangleBuffer.count);
    }

    function drawStripTriangle(){
        setUniforms(program, {u_color:[0,0,0.8,1]});
        setBuffersAndAttributes(gl, program, stripBuffer);
        gl.drawArrays(gl.TRIANGLE_STRIP,0,stripBuffer.count);
    }
</script>
</body>
</html>